apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: core-backplane-artifacthub
  namespace: argocd
spec:
  generators:
    - list:
        elements:
          - cluster: k0s-cntrl
            url: https://k0s-dc1-kubernetes-default.service.dc1.kjdev:6443
            environment: 'prod'
            ingress: artifacthub.int.mylogin.space
  template:
    metadata:
      name: '{{cluster}}-artifacthub'
    spec:
      project: core
  
      source:
        repoURL: https://artifacthub.github.io/helm-charts/
        chart: artifact-hub
        path: artifact-hub
        targetRevision: 1.6.0
        helm:
          releaseName: artifacthub-{{ environment }}
          values: |
            # Hub configuration
            hub:
              ingress:
                enabled: false
              service:
                type: ClusterIP
                port: 80

              deploy:
                readinessGates: []
                replicaCount: 1
                image:
                  # Hub image repository (without the tag)
                  repository: artifacthub/hub
                resources: {}

              server:
                # Allow adding private repositories to the Hub
                allowPrivateRepositories: false
                # Cache directory path. If set, the cache directory for the Helm client will be explicitly set (otherwise
                # defaults to $HOME/.cache), and the directory will be mounted as ephemeral volume (emptyDir)
                cacheDir: ""
                # Directory path where the configuration files should be mounted
                configDir: "/home/hub/.cfg"
                # Hub server base url
                baseURL: artifacthub.int.mylogin.space
                # Hub server shutdown timeout
                shutdownTimeout: 10s
                # Message of the day. The message of the day will be displayed in a banner on the top of the Artifact Hub UI
                motd: ""
                # Message of the day severity. The color used for the banner will be based on the severity selected
                # Options: "info", "warning", "error"
                motdSeverity: info
                basicAuth:
                  # Enable Hub basic auth
                  enabled: false
                cookie:
                  # Hub cookie hash key
                  hashKey: default-unsafe-key
                  # Enable Hub secure cookies
                  secure: false
                csrf:
                  # CSRF authentication key
                  authKey: default-unsafe-key
                  # CSRF secure cookie
                  secure: false
                oauth:
                  oidc:
                    # Enable OIDC
                    enabled: true
                    # OpenID connect issuer url
                    issuerURL: https://idp.mylogin.space/application/o/k0s-dc1/
                    # OpenID connect oauth client id
                    clientID: <secret:CORE0_SITE1/data/ArtifactHub~OpenIDClientID>
                    # OpenID connect oauth client secret
                    clientSecret: <secret:CORE0_SITE1/data/ArtifactHub~OpenIDClientSecret>
                    # OpenID connect oauth redirect url
                    redirectURL: https://artifacthub.int.mylogin.space/oauth/oidc/callback
                    # OpenID connect oauth scopes
                    scopes:
                      - openid
                      - profile
                      - email
                    # Skip email verified check
                    skipEmailVerifiedCheck: false
                # X-Forwarded-For IP index
                xffIndex: 0
              analytics:
                # Google Analytics tracking id
                gaTrackingID: ""
              theme:
                # Colors used in the website
                colors:
                  # Primary color used in the website. For an optimal experience, it's better to use colors that play well with
                  # white fonts
                  primary: "#417598"
                  # Secondary color used in the website, usually a darker version of the primary color. For an optimal experience,
                  # it's better to use colors that play well with white fonts
                  secondary: "#2D4857"
                # Images used in the website
                images:
                  # URL of the image used for the Apple touch icon (192x192)
                  appleTouchIcon192: "/static/media/logo192_v2.png"
                  # URL of the image used for the Apple touch icon (512x512)
                  appleTouchIcon512: "/static/media/logo512_v2.png"
                  # URL of the image used in the og:image tag. This image is displayed when an Artifact Hub link is shared in
                  # Twitter or Slack, for example. The URL must use `https`
                  openGraphImage: "/static/media/artifactHub_v2.png"
                  # URL of the image used for the shortcut icon (also known as favicon)
                  shortcutIcon: "/static/media/logo_v2.png"
                  # URL of the logo used in the website header. For an optimal experience, it's better to use a white logo with
                  # transparent background, with no margin around it. It'll be displayed using a maximum height of 20px and a
                  # maximum width of 185px
                  websiteLogo: "/static/media/logo/artifacthub-brand-white.svg"
                # Sample search queries used in home and no results found pages
                sampleQueries: []
                # Name of the site. This name is displayed in some places in the website and email templates. When a different
                # value than the default one (Artifact Hub) is provided, the site enters `white label` mode. In this mode, some
                # sections of the website are displayed in a more generic way, omitting certain parts that are unique to Artifact Hub
                siteName: "KJDev Artifact hub"

            log:
              level: error

            tracker:
              cronjob:
                image:
                  repository: artifacthub/tracker
                resources: {}
              cacheDir: ""
              configDir: "/home/tracker/.cfg"
              concurrency: 64
              repositoriesNames: []
              repositoriesKinds: []
              bypassDigestCheck: true

      destination:
        server: '{{url}}'
        namespace: core-prod
