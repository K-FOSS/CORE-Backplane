apiVersion: external-secrets.io/v1alpha1
kind: ExternalSecret
metadata:
  name: minio-prometheus-sync
  namespace: 
spec:
  secretStoreRef:
    name: vault-backend
    kind: ClusterSecretStore
  target:
    creationPolicy: Owner
    name: minio-prom-additional-scrape-config
    template:
      engineVersion: v2
      data:
        config.env: |
          - job_name: kjdev-core-minio-job
            bearer_token: {{ .Token }}
            metrics_path: /minio/v2/metrics/cluster
            scheme: https
            scrape_interval: 1m
            scrape_timeout: 20s
            tls_config:
              insecure_skip_verify: true
            static_configs:
            - targets:
              - minio.core-prod.svc.cluster.local:443

  data:
    - secretKey: Token
      remoteRef:
        key: Minio
        property: AccessToken
