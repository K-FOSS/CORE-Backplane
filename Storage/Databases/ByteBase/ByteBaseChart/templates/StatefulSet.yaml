apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: bytebase
  namespace: {{ template "bytebase.namespace" . }}
spec:
  selector:
    matchLabels:
      app: bytebase
  serviceName: "bytebase"
  replicas: 1
  template:
    metadata:
      labels:
        app: bytebase
    spec:
      containers:
        - name: bytebase
          image: "bytebase/bytebase:{{ .Chart.AppVersion }}"
          env:
            - name: NODE_ENV
              value: 'development'

            - name: BB_DEV_LICENSE
              value: 'eyJhbGciOiJSUzI1NiIsImtpZCI6InYxIiwidHlwIjoiSldUIn0.eyJpbnN0YW5jZUNvdW50Ijo5OTk5LCJ0cmlhbGluZyI6ZmFsc2UsInBsYW4iOiJURUFNIiwiYXVkIjoiYmIubGljZW5zZSIsImV4cCI6MzMxNjkzOTIwMDAsImlhdCI6MTY0MzQ2Mzg4MiwiaXNzIjoiYnl0ZWJhc2UiLCJzdWIiOiI2NzUxODU0NS45MTI4NjI4NSJ9.plmS-PNPsI-Esis1ZCLWYgbx7K3C1AlQKG7pY1w_stuxOZgpSK3wm-GC4ILg8e6HebqAhz_39X2f9DvvOFySbnPffJ9v3Q3bTwxgk9vR1ttorS9VTWlZNv2tRmKeQD1rZCIS3gRV8pLX4WEClkn41Bv4DFnmQfcEXeBnw_DivE_yMFgrAmxFeyJVZfP0NslXBBRcwiZ_nObntF_65k6Hr4uPXFR5L99XCCqg5Fu-R0lj7tCbheHBQyXbDujBYqrltbVsrN5ov8Mc7gqbgV9KTCEfAzLsgygO2epkuQkMYdXxRz_oWDLED0WwCZ7-EMz3EqLngZjr6e_hHcapt6SSNQ'
          ports:
            - containerPort: 80
              name: web
          volumeMounts:
            - mountPath: /var/opt/bytebase
              name: sqlite
          readinessProbe:
            httpGet:
              path: /api/actuator/info
              port: web
            initialDelaySeconds: 2
            periodSeconds: 2
  volumeClaimTemplates:
    - metadata:
        name: sqlite
      spec:
        accessModes:
          - ReadWriteOnce
        resources:
          requests:
            storage: "{{ .Values.bytebase.storage }}"
