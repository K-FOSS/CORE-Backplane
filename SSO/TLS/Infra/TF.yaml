apiVersion: infra.contrib.fluxcd.io/v1alpha1
kind: Terraform
metadata:
  name: k0s-cntrl-sso-tls-new
spec:
  path: ./SSO/TLS/TF
  approvePlan: auto
  interval: 1m
  alwaysCleanupRunnerPod: false
  tfstate:
    forceUnlock: 'yes'

  runnerPodTemplate:
    spec:
      env:
        - name: AUTHENTIK_TOKEN
          valueFrom:
            secretKeyRef:
              name: k0s-cntrl-sso-tls-aaatoken
              key: Token

  fileMappings:
    - location: workspace
      path: TLS/MyLogin/TLS.crt
      secretRef:
        name: myloginspace-default-certificates
        key: tls.crt

    - location: workspace
      path: TLS/MyLogin/TLS.key
      secretRef:
        name: myloginspace-default-certificates
        key: tls.key
      

  sourceRef:
    kind: GitRepository
    name: k0s-cntrl-sso-tls

  writeOutputsToSecret:
    name: k0s-cntrl-sso-tls-output

