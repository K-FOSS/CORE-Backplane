---
{{- include "bjw-s.common.loader.init" . }}

{{- define "app-template.hardcodedValues" -}}
# Set the nameOverride based on the release name if no override has been set
{{ if not .Values.global.nameOverride }}
global:
  nameOverride: "{{ .Release.Name }}"
{{ end }}

controllers:
{{- range .Values.iDRACs -}}
  {{- .name -}}:
    containers:
      main:
        image:
          repository: domistyle/idrac6
          tag: latest
          pullPolicy: IfNotPresent

        env:
          - name: IDRAC_USER
            valueFrom:
              secretKeyRef:
                name: 'dellbmc'
                key: SecretKey

          - name: IDRAC_PASSWORD
            valueFrom:
              secretKeyRef:
                name: 'dellbmc'
                key: SecretKey

        # -- Probe configuration
        # -- [[ref]](https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/)
        # @default -- See below
        probes:
          # -- Liveness probe configuration
          # @default -- See below
          liveness:
            # -- Enable the liveness probe
            enabled: false

          # -- Redainess probe configuration
          # @default -- See below
          readiness:
            # -- Enable the readiness probe
            enabled: false

          # -- Startup probe configuration
          # @default -- See below
          startup:
            # -- Enable the startup probe
            enabled: false
{{- end -}}

{{- end -}}
{{- $_ := mergeOverwrite .Values (include "app-template.hardcodedValues" . | fromYaml) -}}

{{/* Render the templates */}}
{{ include "bjw-s.common.loader.generate" . }}
