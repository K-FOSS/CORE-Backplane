traefik:
  additionalArguments:
    - '--serverstransport.insecureskipverify=true'
    - '--entryPoints.websecure.forwardedHeaders.insecure'
    - '--tracing.jaeger=true'
    - '--tracing.jaeger.samplingType=const'
    - '--tracing.jaeger.localAgentHostPort=k0s-dc1-tempo-core-tempo-distributed-distributor-core-prod.service.dc1.kjdev:6831'
    - '--tracing.jaeger.samplingParam=0.25'
  
  globalArguments:
    - '--global.checknewversion'
    - '--global.sendanonymoususage'

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/name
                  operator: In
                  values:
                    - traefik
            topologyKey: kubernetes.io/hostname

  env:
    - name: JAEGER_AGENT_HOST
      value: k0s-dc1-tempo-core-tempo-distributed-distributor-core-prod.service.dc1.kjdev

    - name: JAEGER_AGENT_PORT
      value: '6831'

    - name: JAEGER_SAMPLER_TYPE
      value: 'const'

    - name: JAEGER_SAMPLER_PARAM
      value: '0.25'
    
    - name: JAEGER_TAGS
      value: app=traefik-core

  priorityClassName: 'system-cluster-critical'

  securityContext:
    capabilities:
      add:
        - NET_BIND_SERVICE
    readOnlyRootFilesystem: true
    runAsGroup: 0
    runAsNonRoot: false
    runAsUser: 0

  deployment:
    kind: Deployment
    labels: {}
    minReadySeconds: 15
    podAnnotations: {}
    podLabels:
      logs: loki-myloginspace
    replicas: 3

  ingressRoute:
    dashboard:
      enabled: true
      # Additional ingressRoute annotations (e.g. for kubernetes.io/ingress.class)
      annotations: {}
      # Additional ingressRoute labels (e.g. for filtering IngressRoute by custom labels)
      labels: {}

  ingressClass:
    enabled: true
    fallbackApiVersion: v1
    isDefaultClass: true

  experimental:
    http3:
      enabled: false

  providers:
    kubernetesCRD:
      allowCrossNamespace: true
      allowExternalNameServices: true
      enabled: true
      namespaces: null
    kubernetesIngress:
      allowExternalNameServices: true
      enabled: true
      namespaces: null
      publishedService:
        enabled: true

  volumes: []
  # - name: public-cert
  #   mountPath: "/certs"
  #   type: secret
  #   mountPath: "/config"
  #   type: configMap

  # Additional volumeMounts to add to the Traefik container
  additionalVolumeMounts: []
    # For instance when using a logshipper for access logs
    # - name: traefik-logs
    #   mountPath: /var/log/traefik

  # Logs
  # https://docs.traefik.io/observability/logs/
  logs:
    # Traefik logs concern everything that happens to Traefik itself (startup, configuration, events, shutdown, and so on).
    general:
      # By default, the logs use a text format (common), but you can
      # also ask for the json format in the format option
      # format: json
      # By default, the level is set to ERROR. Alternative logging levels are DEBUG, PANIC, FATAL, ERROR, WARN, and INFO.
      level: ERROR
    access:
      # To enable access logs
      enabled: false
      # By default, logs are written using the Common Log Format (CLF).
      # To write logs in JSON, use json in the format option.
      # If the given format is unsupported, the default (CLF) is used instead.
      # format: json
      # To write the logs in an asynchronous fashion, specify a bufferingSize option.
      # This option represents the number of log lines Traefik will keep in memory before writing
      # them to the selected output. In some cases, this option can greatly help performances.
      # bufferingSize: 100
      # Filtering https://docs.traefik.io/observability/access-logs/#filtering
      filters: {}
        # statuscodes: "200,300-302"
        # retryattempts: true
        # minduration: 10ms
      # Fields
      # https://docs.traefik.io/observability/access-logs/#limiting-the-fieldsincluding-headers
      fields:
        general:
          defaultmode: keep
          names: {}
            # Examples:
            # ClientUsername: drop
        headers:
          defaultmode: drop
          names: {}
            # Examples:
            # User-Agent: redact
            # Authorization: drop
            # Content-Type: keep

  metrics:
    # datadog:
    #   address: 127.0.0.1:8125
    # influxdb:
    #   address: localhost:8089
    #   protocol: udp
    prometheus:
      entryPoint: metrics
      addRoutersLabels: true
    # statsd:
    #   address: localhost:8125

  ports:
    dhcp:
      port: 67
      protocol: UDP
      expose: true

    tftp:
      port: 69
      protocol: UDP
      expose: true

    dns:
      port: 53
      protocol: UDP
      expose: false

    turn:
      port: 3478
      protocol: UDP
      expose: true

    metrics:
      port: 9100
      protocol: TCP

    minio:
      port: 9080
      protocol: TCP

    traefik:
      exposedPort: 9000
      port: 9000
      protocol: TCP
    web:
      exposedPort: 80
      port: 80
      protocol: TCP
    websecure:
      exposedPort: 443
      port: 443
      protocol: TCP
      proxyProtocol:
        insecure: true
        trustedIPs:
          - 0.0.0.0/0
      tls:
        certResolver: ''
        domains: null
        enabled: true
        options: ''

pomerium:
  extraVolumes:
    - name: minio-token
      secret:
        secretName: test-tmp-minio

  priorityClassName: 'tier2-priority'

  resources: null

  podLabels:
    sidecar.istio.io/inject: 'true'

  podAnnotations:
    sidecar.istio.io/inject: 'true'

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchExpressions:
                - key: app.kubernetes.io/instance
                  operator: In
                  values:
                    - pomerium-core
            topologyKey: kubernetes.io/hostname

  extraVolumeMounts:
    - name: minio-token
      mountPath: "/var/secrets/minio-token"
      readOnly: true              

  authenticate:
    existingTLSSecret: pomerium-tls
    idp:
      provider: oidc
      url: https://idp.mylogin.space/application/o/pomeriumproxy-auth/
    proxied: false
    replicaCount: 2

  authorize:
    existingTLSSecret: pomerium-tls
    replicaCount: 2

  config:
    administrators: k@kristianjones.dev
    existingSharedSecret: pomerium-secrets
    existingSigningKeySecret: pomerium-signing-key
    extraOpts:
      jwt_claims_headers: email,groups,user,nickname,preferred_username
    forceGenerateServiceSecrets: false
    forceGenerateSigningKey: false
    forceGenerateTLS: false
    generateSigningKey: false
    existingCASecret: pomerium-tls
    generateTLS: false
    insecure: false
    insecureProxy: false
    rootDomain: int.mylogin.space
    sharedSecret: ''
    signingKey: ''
    routes:
      - from: https://test-k8s.int.mylogin.space
        to: http://console.minio-operator.svc.cluster.local:9090
        tls_skip_verify: true
        kubernetes_service_account_token_file: /var/secrets/minio-token/token
        allowed_idp_claims:
          groups:
            - Network

      - from: https://kubernetes.int.mylogin.space
        to: https://kubernetes.default.svc
        tls_skip_verify: true
        kubernetes_service_account_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        allowed_idp_claims:
          groups:
            - Network

      - from: https://kiali.int.mylogin.space
        to: http://kiali.kiali-operator.svc:20001
        tls_skip_verify: true
        kubernetes_service_account_token_file: /var/run/secrets/kubernetes.io/serviceaccount/token
        allow_websockets: true
        allowed_idp_claims:
          groups:
            - Network
            - Server

      - from: https://controlcenter.house
        to: http://k0s-dc1-homeassistant-core-home-assistant-core-prod.service.dc1.kjdev:8123
        pass_identity_headers: true
        allow_websockets: true
        allowed_idp_claims:
          groups:
            - Home Users

  databroker:
    existingTLSSecret: pomerium-tls
    replicaCount: 2
    service:
      annotations: {}
      clusterIP: None
      type: ClusterIP
    storage:
      connectionString: redis://10.1.1.68:6379/5
      tlsSkipVerify: false
      type: redis

  extraArgs: {}
  extraEnv: {}

  forwardAuth:
    enabled: true
    internal: true

  fullnameOverride: ''

  ingress:
    enabled: false
    className: traefik-core
    annotations:
      traefik.ingress.kubernetes.io/router.entrypoints: websecure
      traefik.ingress.kubernetes.io/router.tls: 'true'
    secret:
      name: myloginspace-int-default-certificates
    tls:
      hosts:
        - '*.int.mylogin.space'

  apiProxy:
    enabled: true
    ingress: false

  ingressController:
    config:
      operatorMode: true
      updateStatus: true
      ingressClass: 'traefik.io/ingress-controller'
    ingressClassResource:
      enabled: false
      name: traefik-core

    enabled: true

  metrics:
    enabled: true
    port: 9090

  proxy:
    existingTLSSecret: pomerium-tls
    replicaCount: 2
    deployment:
      podAnnotations:
        traffic.sidecar.istio.io/excludeInboundPorts: '80,443'

  rbac:
    create: true

  redis:
    enabled: false

  replicaCount: 2
  serviceMonitor:
    enabled: true
  tracing:
    debug: false
    enabled: true
    jaeger:
      agent_endpoint: k0s-dc1-tempo-core-tempo-distributed-distributor-core-prod.service.dc1.kjdev:6831
      collector_endpoint: http://k0s-dc1-tempo-core-tempo-distributed-distributor-core-prod.service.dc1.kjdev:14268/api/traces
    provider: jaeger
