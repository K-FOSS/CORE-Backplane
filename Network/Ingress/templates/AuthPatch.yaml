apiVersion: gateway.envoyproxy.io/v1alpha1
kind: EnvoyPatchPolicy
metadata:
  name: auth-gw
  namespace: kube-system
spec:
  targetRef:
    group: gateway.networking.k8s.io
    kind: GatewayClass
    namespace: kube-system
    name: eg

  type: JSONPatch
  jsonPatches:
    - type: type.googleapis.com/envoy.config.listener.v3.Listener
      # The listener name is of the form <GatewayNamespace>/<GatewayName>/<GatewayListenerName>
      name: kuadrant-core-prod-main-gw-httpsmylogin
      operation:
        op: add
        path: "/filterChains/3/filters/0/typed_config/httpFilters/1"
        value:
          name: envoy.filters.http.ext_authz
          typed_config:
            '@type': >-
              type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz
            grpc_service:
              google_grpc:
                statPrefix: listener-insecure
                target_uri: >-
                  authorino-authorino-authorization.kuadrant-system.svc.k0s.resolvemy.host:50051
            transport_api_version: V3