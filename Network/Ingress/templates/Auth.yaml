---
# See: https://www.authelia.com/integration/kubernetes/istio/
#      https://www.envoyproxy.io/docs/envoy/v1.26.2/configuration/http/http_filters/ext_authz_filter#config-http-filters-ext-authz
#      https://www.envoyproxy.io/docs/envoy/latest/api-v3/extensions/filters/http/ext_authz/v3/ext_authz.proto.html#extensions-filters-http-ext-authz-v3-extauthz
#      https://istio.io/latest/docs/reference/config/istio.mesh.v1alpha1/#MeshConfig-ExtensionProvider-EnvoyExternalAuthorizationHttpProvider
apiVersion: cilium.io/v2
kind: CiliumClusterwideEnvoyConfig
metadata:
  name: envoy-ext-authz-http
spec:
  resources:
    - "@type": type.googleapis.com/envoy.extensions.filters.http.ext_authz.v3.ExtAuthz
      name: envoy.filters.http.ext_authz
      transport_api_version: V3
      failure_mode_allow: true
      include_peer_certificate: true
      grpc_service:
        envoy_grpc:
          cluster_name: core-prod:authorino-authorino-authorization:50051
          timeout: 1s