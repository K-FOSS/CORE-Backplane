apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
    name: authentik-policy
    namespace: external-istiod

spec:
  selector:
    matchLabels:
      istio: ingressgateway

  action: CUSTOM

  provider:
    name: 'authentik'

  rules:
    - to:
        - operation:
            notPaths:
              - /auth/token
              - /api/google_assistant
              - /api/google_assistant/*
              - /api/webhook
              - /api/webhook/*
              - /api/websocket
              - /api/websocket/*
              - /api/mobile_app
              - /api/mobile_app/*
              - /api/ios
              - /api/ios/*
            hosts:
              # You can create a single resource and list all Domain names here, or create multiple resources
              - controlcenter.house

        - operation:
            hosts:
              # You can create a single resource and list all Domain names here, or create multiple resources
              - code.controlcenter.house
              - grocy.controlcenter.house
