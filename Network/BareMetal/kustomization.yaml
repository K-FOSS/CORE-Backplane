apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  #
  # TODO: Automate this version with GitOps and Renovate or my own custom CAS-Updater 
  #

  # Tinkerbell Cluster API
  - https://github.com/tinkerbell/cluster-api-provider-tinkerbell/releases/download/v0.6.4/infrastructure-components.yaml


patches:
  - target:
      kind: Deployment
      name: capt-controller-manager

    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/env/0/value
        value: 10.1.1.66

  - target:
      kind: Deployment

    patch: |-
      - op: add
        path: /spec/template/metadata/labels/logs
        value: loki-myloginspace


  - target:
      kind: Deployment
      name: tink-server

    patch: |-
      - op: replace
        path: /spec/template/spec/containers/0/env
        value:
          - name: OTEL_EXPORTER_OTLP_ENDPOINT
            value: dc1-k3s-node1-collectors-alloy.core-prod.svc.cluster.local:4317

          - name: OTEL_EXPORTER_OTLP_INSECURE
            value: 'true'

  - target:
      kind: Service
      name: dc1-k3s-node1-baremetal-core-tftp

    patch: |-
      - op: remove
        path: /spec/ports/0/nodePort