apiVersion: "tinkerbell.org/v1alpha1"
kind: Template
metadata:
  name: kubernetes
spec:
  data: | 
    version: "0.1"
    name: flatcar-installer
    global_timeout: 1800
    tasks:
      - name: "flatcar-install"
        worker: "{{`{{.machine1}}`}}"
        volumes:
          - /dev:/dev
          - /statedir:/statedir
        actions:
          - name: "dump-config"
            image: flatcar-install
            command:
              - sh
              - -c
              - echo "{{`{{.config}}`}}" | base64 -d > /statedir/config.yaml

          - name: "create-ignition"
            image: flatcar-config
            command:
              - /usr/local/bin/flatcar-config
              - -in-file
              - /statedir/config.yaml
              - -out-file
              - /statedir/ignition.json

          - name: "flatcar-install"
            image: flatcar-install
            command:
              - /usr/local/bin/flatcar-install
              - -v
              - -s
              - -i
              - /statedir/ignition.json
