
apiVersion: cluster.x-k8s.io/v1beta1
kind: Cluster
metadata:
  name: kub-poc

  annotations:
    argocd.argoproj.io/sync-wave: '10'

spec:
  clusterNetwork:
    pods:
      cidrBlocks:
        - 192.168.0.0/16
    services:
      cidrBlocks:
        - 172.26.0.0/16

  controlPlaneRef:
    apiVersion: controlplane.cluster.x-k8s.io/v1alpha3
    kind: TalosControlPlane
    name: talos-cp

  infrastructureRef:
    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
    kind: TinkerbellCluster
    name: kub-poc

---
apiVersion: controlplane.cluster.x-k8s.io/v1alpha3
kind: TalosControlPlane
metadata:
  name: talos-cp
spec:
  version: v1.32.2
  replicas: 1
  infrastructureTemplate:
    apiVersion: infrastructure.cluster.x-k8s.io/v1beta1
    kind: TinkerbellMachineTemplate
    name: kub-poc-control-plane
    namespace: core-prod

  controlPlaneConfig:
    controlplane:
      generateType: controlplane
---
apiVersion: tinkerbell.org/v1alpha1
kind: Hardware
metadata:
  name: infra2

  labels:
    idrac-version: '6'
    manufacturer: dell
    resolvemy.host/dc: '1'
    resolvemy.host/machinetype: baremetal    
    resolvemy.host/rack: '1'
    resolvemy.host/nodetype: infra
    cluster.x-k8s.io/cluster-name: tink-test
    pool: test

spec:
  disks:
    - device: /dev/sda

  interfaces:
    - dhcp:
        arch: x86_64
        hostname: infra2
        ip:
          address: 172.16.20.140
          gateway: 172.16.20.254
          netmask: 255.255.255.0
        lease_time: 86400
        mac: f0:4d:a2:09:60:ba
        name_servers:
          - 1.1.1.1
          - 1.0.0.1
      disableDhcp: false
      netboot:
        allowPXE: true
        allowWorkflow: false
        ipxe:
          contents: | # shell
            #!ipxe

            imgfree
            kernel https://pxe.factory.talos.dev/image/3623c5ea66f3e45617feeb145662a23e5ba3b42a2a8378737aab19929957eaa8/v1.9.4/kernel-amd64 talos.platform=metal console=tty1 console=ttyS0 net.ifnames=0 ip=eth0:dhcp init_on_alloc=1 slab_nomerge pti=on consoleblank=0 nvme_core.io_timeout=4294967295 printk.devkmsg=on talos.device.settle_time=5m talos.config=http://10.43.211.207:50061/2009-04-04/user-data
            initrd https://pxe.factory.talos.dev/image/3623c5ea66f3e45617feeb145662a23e5ba3b42a2a8378737aab19929957eaa8/v1.9.4/initramfs-amd64.xz
            boot
  metadata:
    facility:
      facility_code: onprem
    instance:
      hostname: infra2
      id: f0:4d:a2:09:60:ba
    manufacturer:
      slug: dell
