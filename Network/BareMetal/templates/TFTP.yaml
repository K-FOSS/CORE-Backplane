apiVersion: apps/v1
kind: Deployment
metadata:
  name: s3tftp-deployment
  labels:
    app: s3tftp

spec:
  replicas: 1
  selector:
    matchLabels:
      app: s3tftp

  template:
    metadata:
      labels:
        app: s3tftp

    spec:
      containers:
      - name: s3tftp
        image: ghcr.io/hanazuki/s3tftpd:latest
        args:
          - --force-path-style
          - --endpoint-url=s3.mylogin.space
          - s3://baremetal
        env:
          - name: AWS_ACCESS_KEY_ID
            valueFrom:
              secretKeyRef:
                name: s3-proxy-prod
                key: S3AccessKey

          - name: AWS_SECRET_ACCESS_KEY
            valueFrom:
              secretKeyRef:
                name: s3-proxy-prod
                key: S3SecretKey

        ports:
          - name: udp-tftp
            containerPort: 69
            protocol: UDP
    