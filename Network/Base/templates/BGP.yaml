{{- if index .Values "kube-router" "enabled" }} 
apiVersion: "cilium.io/v2alpha1"
kind: CiliumBGPPeeringPolicy
metadata:
  name: 01-bgp-peering-policy
spec: # CiliumBGPPeeringPolicySpec
  nodeSelector:
    matchLabels:
      beta.kubernetes.io/os: linux

  virtualRouters:
    - exportPodCIDR: true
      localASN: 64512
      neighbors:
        - connectRetryTimeSeconds: 120
          eBGPMultihopTTL: 1
          gracefulRestart:
            enabled: true
            restartTimeSeconds: 120
          holdTimeSeconds: 90
          keepAliveTimeSeconds: 30
          peerASN: 64567
          peerAddress: 172.16.51.100/24
          peerPort: 179

        - connectRetryTimeSeconds: 120
          eBGPMultihopTTL: 1
          gracefulRestart:
            enabled: true
            restartTimeSeconds: 120
          holdTimeSeconds: 90
          keepAliveTimeSeconds: 30
          peerASN: 64567
          peerAddress: 172.16.52.100/24
          peerPort: 179

        - connectRetryTimeSeconds: 120
          eBGPMultihopTTL: 1
          holdTimeSeconds: 90
          keepAliveTimeSeconds: 30
          peerASN: 64567
          peerAddress: 172.16.53.100/24
          peerPort: 179

        - connectRetryTimeSeconds: 120
          eBGPMultihopTTL: 1
          holdTimeSeconds: 90
          keepAliveTimeSeconds: 30
          peerASN: 64567
          peerAddress: 172.16.54.100/24
          peerPort: 179

      serviceSelector:
        matchExpressions:
          - key: io.kubernetes.service.namespace
            operator: NotIn
            values:
              - test
{{- end }}
