{{- $secret := (lookup "v1" "Secret" .Release.Namespace "submariner-broker-client-token") }}
apiVersion: submariner.io/v1alpha1
kind: Submariner
metadata:
  name: submariner-core
  namespace: submariner-operator

spec:
  broker: k8s
  brokerK8sApiServer: {{ .Values.cilium.k8sServiceHost }}
  brokerK8sApiServerToken: ''
  brokerK8sCA: '{{ index $secret.data "ca.crt"  }}'
  brokerK8sInsecure: false
  brokerK8sRemoteNamespace: kube-system

  cableDriver: libreswan
  ceIPSecDebug: false
  ceIPSecForceUDPEncaps: false
  ceIPSecIKEPort: 500
  ceIPSecNATTPort: 4500
  ceIPSecPSK: null
  clusterCIDR: '{{ .Values.submariner-operator.submariner.clusterCidr }}'
  clusterID: '{{ .Values.submariner-operator.submariner.clusterId }}'
  colorCodes: blue

  connectionHealthCheck:
    enabled: true
    intervalSeconds: 1
    maxPacketLossCount: 5

  debug: false
  globalCIDR: '{{ .Values.submariner-operator.submariner.globalCidr }}'

  loadBalancerEnabled: false
  namespace: kube-system
  natEnabled: false

  repository: quay.io/submariner
  serviceCIDR: '{{ .Values.submariner-operator.submariner.serviceCidr }}'
  serviceDiscoveryEnabled: true
  version: 0.17.0-m2
