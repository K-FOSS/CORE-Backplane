apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: traefik
spec:
  hosts:
    - accessmyporn.download
    - resolvemy.host
    - controlcenter.house
    - '*.controlcenter.house'
    - 'feeds.kjmedia.stream'
    - '*.mylogin.space'
    - '*.writemy.codes'
    - '*.ipaddr.network'
    - 'ytdl.kjmedia.stream'
    - 'sonarr.kjmedia.stream'
    - 'radarr.kjmedia.stream'
    - 'prowlarr.kjmedia.stream'
    - 'bitwarden.kristianjones.dev'

    # IP Addresses
    - 10.1.1.83
  gateways:
    - traefik-gateway
  http:
    - name: pomerium-authn
      match:
        - headers:
            host:
              exact: 'authenticate.int.mylogin.space'
      route:
        - destination:
            port:
              number: 80
            host: traefik-core-pomerium-authenticate.core-prod.svc.k0s.resolvemy.host

    - name: minio
      match:
        - headers:
            host:
              exact: s3.mylogin.space
      route:
        - destination:
            port:
              number: 443
            host: minio.mylogin.space

    - name: logs-web
      match:
        - headers:
            host:
              exact: logs.mylogin.space
      route:
        - destination:
            port:
              number: 80
            host: loki-core-loki-distributed-gateway.core-prod.svc.k0s.resolvemy.host

    - name: metrics-web
      match:
        - headers:
            host:
              exact: metrics.mylogin.space
      route:
        - destination:
            port:
              number: 80
            host: cortex-core-mimir-nginx.core-prod.svc.k0s.resolvemy.host

    - name: wip-static-cdn
      match:
        - headers:
            host:
              exact: 'static.mylogin.space'

        - headers:
            host:
              exact: '10.1.1.83'
      route:
        - destination:
            port:
              number: 80
            host: traefik-core-s3-proxy.core-prod.svc.k0s.resolvemy.host

  tls:
    - match:
        - port: 443
          sniHosts:
            - accessmyporn.download
            - resolvemy.host
            - controlcenter.house
            - '*.controlcenter.house'
            - '*.mylogin.space'
            - '*.int.mylogin.space'
            - '*.writemy.codes'
            - '*.ipaddr.network'
            - 'bitwarden.kristianjones.dev'
            - ytdl.kjmedia.stream
            - feeds.kjmedia.stream
            - sonarr.kjmedia.stream
            - radarr.kjmedia.stream
            - prowlarr.kjmedia.stream
      route:
        - destination:
            host: traefik-core.core-prod.svc.k0s.resolvemy.host
            port:
              number: 443
          weight: 100

