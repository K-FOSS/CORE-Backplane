apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: core-backplane-storage-search
  namespace: argocd
spec:
  generators:
    - list:
        elements:
          - cluster: k0s-cntrl
            url: https://10.1.1.40:443

  template:
    metadata:
      name: '{{cluster}}-search'

      annotations:
        argocd.argoproj.io/manifest-generate-paths: .


    spec:
      project: core


      source:
        path: Storage/Search
        repoURL: https://gitlab.git.writemy.codes/KJDev/CORE-Backplane.git
        targetRevision: HEAD
        plugin:
          name: argocd-lovely-plugin
          env:
            - name: LOVELY_HELM_MERGE
              value: |-
                openobserve:
                  # Credentials for authentication
                  auth:
                    ZO_ROOT_USER_EMAIL: "root@example.com"
                    ZO_ROOT_USER_PASSWORD: "Complexpass#123"

                    # do not need to set this if enabled minio is being used. settings will be picked from minio section. Also IRSA is preferred if on EKS. Set the Service account section with the correct IAM role ARN. Refer https://zinc.dev/docs/guide/ha_deployment/#amazon-eks-s3
                    ZO_S3_ACCESS_KEY: ""
                    ZO_S3_SECRET_KEY: ""

      destination:
        server: '{{url}}'
        namespace: core-prod
